// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Repository {
  id              String       @id @default(cuid())
  platform        PlatformType
  platformId      String
  homePage        String?
  size            Int
  stargazersCount Int
  watchersCount   Int
  forksCount      Int
  openIssuesCount Int
  score           Int?
  hasIssues       Boolean
  hasProjects     Boolean
  hasWiki         Boolean
  hasPages        Boolean
  mirrorUrl       String?
  archived        Boolean
  disabled        Boolean
  allowForking    Boolean
  isFork          Boolean
  isTemplate      Boolean
  defaultBranch   String
  createdAt       DateTime
  updatedAt       DateTime
  pushedAt        DateTime
  extractedAt     DateTime     @default(now())
  recordUpdatedAt DateTime     @updatedAt
  name            String
  description     String?
  Owner           Owner        @relation(fields: [ownerId], references: [id])
  ownerId         String
  Language        Language?    @relation(fields: [languageId], references: [id])
  languageId      String?
  License         License?     @relation(fields: [licenseId], references: [id])
  licenseId       String?
  Topics          Topic[]

  @@unique([platform, platformId])
}

model License {
  id           String       @id @default(cuid())
  key          String       @unique
  name         String
  spdxId       String
  Repositories Repository[]
}

model Topic {
  id           String       @id @default(cuid())
  name         String       @unique
  Repositories Repository[]
  createdAt    DateTime     @default(now())
}

model Owner {
  id              String       @id @default(cuid())
  platform        PlatformType
  platformId      String
  login           String       @unique
  gravatarId      String
  type            OwnerType
  siteAdmin       Boolean
  Repositories    Repository[]
  extractedAt     DateTime     @default(now())
  recordUpdatedAt DateTime     @updatedAt

  @@unique([platform, platformId])
}

model Language {
  id           String       @id @default(cuid())
  name         String
  slug         String       @unique
  description  String?
  Repositories Repository[]
}

enum OwnerType {
  User
  Organization
}

enum PlatformType {
  GitHub
  GitLab
  BitBucket
}
