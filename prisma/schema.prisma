// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Repository {
  id              String       @id @default(cuid())
  platform        PlatformType
  platformId      Int
  nodeId          String       @unique
  homePage        String?
  size            Int
  stargazerscount Int
  watchersCount   Int
  forksCount      Int
  openIssuesCount Int
  score           Int
  language        String?
  hasIssues       Boolean
  hasProjects     Boolean
  hasWiki         Boolean
  hasPages        Boolean
  mirrorUrl       String?
  archived        Boolean
  disabled        Boolean
  allowForking    Boolean
  isTemplate      Boolean
  defaultBranch   String
  createdAt       DateTime
  updatedAt       DateTime
  pushedAt        DateTime
  extractedAt     DateTime     @default(now())
  recordUpdatedAt DateTime     @updatedAt
  name            String
  description     String?
  isFork          Boolean
  Owner           Owner        @relation(fields: [ownerId], references: [id])
  ownerId         String
  License         License?     @relation(fields: [licenseId], references: [id])
  licenseId       String?
  Topics          Topic[]

  @@unique([platform, platformId])
  @@index([language])
}

model License {
  id           String       @id @default(cuid())
  key          String       @unique
  nodeId       String       @unique
  name         String
  spdxId       String
  Repositories Repository[]
}

model Topic {
  id           String       @id @default(cuid())
  name         String       @unique
  Repositories Repository[]
  createdAt    DateTime     @default(now())
}

model Owner {
  id              String       @id @default(cuid())
  platform        PlatformType
  platformId      Int
  login           String       @unique
  nodeId          String       @unique
  gravatarId      String
  type            OwnerType
  siteAdmin       Boolean
  Repositories    Repository[]
  extractedAt     DateTime     @default(now())
  recordUpdatedAt DateTime     @updatedAt

  @@unique([platform, platformId])
}

enum OwnerType {
  User
  Organization
}

enum PlatformType {
  GitHub
  GitLab
  BitBucket
}
